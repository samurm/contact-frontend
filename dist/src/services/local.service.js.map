{"version":3,"sources":["services/local.service.js"],"names":["LocalService","_serviceContact","indexedDb","request","open","addEventListener","showerror","start","bind","createdb","contacts","mytransaction","db","transaction","storeContacts","objectStore","contact","put","id","_id","age","gender","name","name_normalized","phone","photo","surname","surname_normalized","storeConctacts","delete","Promise","resolve","reject","openCursor","onsuccess","event","cursor","target","result","value","continue","e","alert","code","message","datababase","createObjectStore","keyPath","createIndex","unique"],"mappings":"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","sourcesContent":["class LocalService{\n    constructor(_serviceContact, indexedDb){\n        this._serviceContact = _serviceContact;\n        this.indexedDb = indexedDb;\n        this.request = this.indexedDb.open(\"mydatabaseBooks\");\n\n        this.request.addEventListener(\"error\", this.showerror);\n        this.request.addEventListener(\"success\", this.start.bind(this));\n        this.request.addEventListener(\"upgradeneeded\", this.createdb);\n    }\n    chargeContacts(contacts){\n        const mytransaction = this.db.transaction(['contacts'], \"readwrite\");\n        const storeContacts = mytransaction.objectStore('contacts');\n        for(const contact of contacts){\n            storeContacts.put({id: contact._id, age:contact.age, gender: contact.gender, name: contact.name, name_normalized: contact.name_normalized, phone: contact.phone, photo: contact.photo, surname: contact.surname, surname_normalized: contact.surname_normalized});\n        }\n    }\n\n    updateOrCreateContact(contact){\n        const mytransaction = this.db.transaction(['contacts'], \"readwrite\");\n        const storeContacts = mytransaction.objectStore('contacts');\n        storeContacts.put({id: contact._id, age:contact.age, gender: contact.gender, name: contact.name, name_normalized: contact.name_normalized, phone: contact.phone, photo: contact.photo, surname: contact.surname, surname_normalized: contact.surname_normalized});\n    }\n\n    deleteContact(id){\n        const mytransaction = this.db.transaction(['contacts'], \"readwrite\");\n        const storeConctacts = mytransaction.objectStore('contacts');\n        storeConctacts.delete(id);\n    }\n\n    getContacts(){\n        return new Promise((resolve,reject) => {\n            const mytransaction = this.db.transaction([\"contacts\"]);\n            const storeConctacts = mytransaction.objectStore(\"contacts\");\n            const request = storeConctacts.openCursor();\n            const contacts = [];\n            request.onsuccess = function(event){\n                const cursor = event.target.result;\n                if(cursor){\n                    contacts[cursor.value.id] = {\n                        _id: cursor.value.id, \n                        gender: cursor.value.gender,\n                        age: cursor.value.age,\n                        name: cursor.value.name,\n                        name_normalized: cursor.value.name_normalized,\n                        phone: cursor.value.phone,\n                        photo: cursor.value.photo,\n                        surname: cursor.value.surname,\n                        surname_normalized: cursor.value.surname_normalized \n                    }\n                    cursor.continue();\n                }else{\n                    resolve(contacts);\n                }\n            }\n        })\n        /* TODO: it doesnt work with then\n        return storeConctacts.openCursor().then(function(cursor){\n            const contacts = {};\n            if (cursor) {\n                contacts[cursor.value.id] = {_id: cursor.value.id, \n                                             gender: cursor.value.gender,\n                                             name: cursor.value.name,\n                                             name_normalized: cursor.value.name_normalized,\n                                             phone: cursor.value.phone,\n                                             photo: cursor.value.photo,\n                                             surname: cursor.value.surname,\n                                             surname_normalized: cursor.value.surname_normalized \n                                            }\n                cursor.continue();\n            }\n            return contacts;\n        }); */\n    }\n\n    showerror(e) {\n        alert(\"Error: \" + e.code + \" \" + e.message);\n    }\n    start(e) {\n        this.db = e.target.result;\n    } \n    createdb(e) {\n        const datababase = e.target.result;\n        const storeContacts = datababase.createObjectStore(\"contacts\", { keyPath: \"id\" });\n        storeContacts.createIndex(\"SearchName\", \"name\", { unique: false });\n    }\n}"],"file":"local.service.js"}